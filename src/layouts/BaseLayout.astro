---
interface Props {
  title: string;
  description?: string;
}

const { title, description = "Personal blog and portfolio" } = Astro.props;
const currentPath = Astro.url.pathname;
---

<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate" type="application/rss+xml" title="Kai's Blog RSS Feed" href="/rss.xml" />
    <title>{title}</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,400;0,6..72,500;0,6..72,600;1,6..72,400&family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
    
    <!-- Theme script (runs before render to prevent flash) -->
    <script is:inline>
      const savedTheme = localStorage.getItem('theme');
      const theme = savedTheme || 'light'; // default to light
      document.documentElement.setAttribute('data-theme', theme);
    </script>
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner">
        <a href="/" class="site-logo">Kai's Blog</a>
        <div class="header-right">
          <nav class="site-nav">
            <a href="/" class:list={[{ active: currentPath === '/' }]}>Blog</a>
            <a href="/about" class:list={[{ active: currentPath === '/about' || currentPath === '/about/' }]}>About</a>
          </nav>
          <button class="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
            <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
            <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
          </button>
        </div>
      </div>
    </header>
    
    <slot />
    
    <footer class="site-footer">
      <div class="footer-inner">
        <p>&copy; {new Date().getFullYear()} Kai Bailey</p>
        <a href="/rss.xml" class="rss-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"/>
          </svg>
          RSS
        </a>
      </div>
    </footer>
    
    <script>
      const toggle = document.querySelector('.theme-toggle');
      
      toggle?.addEventListener('click', () => {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      });
    </script>
  </body>
</html>

<style is:global>
  :root {
    /* Spacing */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 3rem;
    --space-2xl: 5rem;
    
    /* Typography */
    --font-display: 'Newsreader', Georgia, serif;
    --font-body: 'DM Sans', system-ui, sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
    
    /* Layout */
    --max-width: 680px;
    --header-height: 72px;
  }
  
  /* Dark theme */
  [data-theme="dark"] {
    --color-bg: #0f0f12;
    --color-bg-alt: #18181c;
    --color-surface: #1e1e24;
    --color-border: #2a2a32;
    --color-text: #e4e4e7;
    --color-text-secondary: #8b8b94;
    --color-accent: #a8d4a2;
    --color-accent-hover: #c4e4c0;
    --color-accent-muted: rgba(168, 212, 162, 0.15);
  }
  
  /* Light theme */
  [data-theme="light"] {
    --color-bg: #fafaf9;
    --color-bg-alt: #f3f3f1;
    --color-surface: #ffffff;
    --color-border: #e4e4e2;
    --color-text: #1c1c1a;
    --color-text-secondary: #6b6b68;
    --color-accent: #0369a1;
    --color-accent-hover: #0284c7;
    --color-accent-muted: rgba(3, 105, 161, 0.1);
  }
  
  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html {
    scroll-behavior: smooth;
  }
  
  body {
    font-family: var(--font-body);
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-text);
    background: var(--color-bg);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-display);
    font-weight: 500;
    line-height: 1.3;
    color: var(--color-text);
  }
  
  a {
    color: var(--color-accent);
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  a:hover {
    color: var(--color-accent-hover);
  }
  
  img {
    max-width: 100%;
    height: auto;
    display: block;
  }
  
  ::selection {
    background: var(--color-accent);
    color: var(--color-bg);
  }
  
  /* Code blocks */
  pre {
    font-family: var(--font-mono);
    font-size: 0.875rem;
    padding: var(--space-lg);
    border-radius: 8px;
    overflow-x: auto;
    margin: var(--space-lg) 0;
    background: #1e1e1e !important;
    border: 1px solid var(--color-border);
  }
  
  code {
    font-family: var(--font-mono);
    font-size: 0.9em;
  }
  
  :not(pre) > code {
    background: var(--color-surface);
    padding: 0.15em 0.4em;
    border-radius: 4px;
    color: var(--color-accent);
    border: 1px solid var(--color-border);
  }
  
  /* Prose styling */
  .prose {
    max-width: var(--max-width);
    margin: 0 auto;
  }
  
  .prose h1 {
    font-size: 2.25rem;
    margin-bottom: var(--space-lg);
  }
  
  .prose h2 {
    font-size: 1.5rem;
    margin-top: var(--space-xl);
    margin-bottom: var(--space-md);
    padding-top: var(--space-lg);
    border-top: 1px solid var(--color-border);
  }
  
  .prose h3 {
    font-size: 1.25rem;
    margin-top: var(--space-lg);
    margin-bottom: var(--space-sm);
  }
  
  .prose p {
    margin-bottom: var(--space-md);
  }
  
  .prose ul, .prose ol {
    margin-bottom: var(--space-md);
    padding-left: var(--space-lg);
  }
  
  .prose li {
    margin-bottom: var(--space-sm);
  }
  
  .prose blockquote {
    border-left: 3px solid var(--color-accent);
    padding-left: var(--space-lg);
    margin: var(--space-lg) 0;
    font-style: italic;
    color: var(--color-text-secondary);
  }
  
  .prose img {
    border-radius: 8px;
    margin: var(--space-lg) 0;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }
  
  .prose hr {
    border: none;
    border-top: 1px solid var(--color-border);
    margin: var(--space-xl) 0;
  }
  
  .prose strong {
    font-weight: 600;
  }
  
  .prose table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--space-lg) 0;
    font-size: 0.9rem;
  }
  
  .prose th, .prose td {
    padding: var(--space-sm) var(--space-md);
    border: 1px solid var(--color-border);
    text-align: left;
  }
  
  .prose th {
    background: var(--color-surface);
    font-weight: 500;
  }
</style>

<style>
  .site-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--color-bg);
    border-bottom: 1px solid var(--color-border);
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }
  
  @supports (backdrop-filter: blur(12px)) {
    .site-header {
      background: color-mix(in srgb, var(--color-bg) 85%, transparent);
      backdrop-filter: blur(12px);
    }
  }
  
  .header-inner {
    max-width: 1000px;
    margin: 0 auto;
    padding: var(--space-md) var(--space-lg);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .site-logo {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 500;
    color: var(--color-text);
    letter-spacing: -0.02em;
  }
  
  .site-logo:hover {
    color: var(--color-accent);
  }
  
  .header-right {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
  }
  
  .site-nav {
    display: flex;
    gap: var(--space-lg);
  }
  
  .site-nav a {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    font-weight: 400;
    padding: var(--space-xs) 0;
    position: relative;
  }
  
  .site-nav a:hover,
  .site-nav a.active {
    color: var(--color-text);
  }
  
  .site-nav a.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--color-accent);
    border-radius: 1px;
  }
  
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 8px;
    background: var(--color-surface);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid var(--color-border);
  }
  
  .theme-toggle:hover {
    color: var(--color-accent);
    border-color: var(--color-accent);
  }
  
  /* Show/hide icons based on theme */
  [data-theme="dark"] .sun-icon { display: block; }
  [data-theme="dark"] .moon-icon { display: none; }
  [data-theme="light"] .sun-icon { display: none; }
  [data-theme="light"] .moon-icon { display: block; }
  
  .site-footer {
    margin-top: auto;
    padding: var(--space-xl) var(--space-lg);
    border-top: 1px solid var(--color-border);
    background: var(--color-bg-alt);
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }
  
  .footer-inner {
    max-width: 1000px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .site-footer p {
    font-size: 0.85rem;
    color: var(--color-text-secondary);
  }
  
  .rss-link {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: 0.85rem;
    color: var(--color-text-secondary);
  }
  
  .rss-link:hover {
    color: var(--color-accent);
  }
  
  @media (max-width: 640px) {
    .footer-inner {
      flex-direction: column;
      gap: var(--space-md);
    }
  }
</style>
